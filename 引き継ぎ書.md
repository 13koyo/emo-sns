# emo-sns 引き継ぎ書

**作成日**: 2026年2月8日  
**最終更新**: 2026年2月13日  
**作成者**: Antigravity AI アシスタント

---

## 📋 プロジェクト概要

**emo-sns** は「安心して本音・弱音を発信できる、みんなの居場所」をコンセプトにしたSNS/掲示板アプリです。

- **技術スタック**: Next.js 14 (App Router), TypeScript, CSS Modules
- **主な機能**: 投稿、5種類の共感リアクション、コメント、ブロック機能

---

## ✅ 完了した作業

### 1. コメント投稿のバグ修正
- **問題**: ネガティブワード（「バカ」等）を投稿するとエラーでUIが壊れていた
- **対応**: 
  - `src/app/page.tsx` の `handleComment` 関数でAPIエラーを正しく検知
  - エラー時はアラートを表示するように修正
  - `src/app/api/comments/route.ts` でネガティブワードフィルター実装済み

### 2. コメントブロック解除機能
- **ファイル**: `src/components/CommentSection.tsx`
- **内容**: 
  - ブロック済みコメントの表示/非表示切り替えボタン
  - 個別のブロック解除ボタン（🔓 解除）
  - `src/lib/blockList.ts` に `unblockUser()` 関数追加

### 3. ドキュメント整備
- **配信ロードマップ**: Phase 2にAIモデレーション計画を追記
- **共有メモ**: `shared_memo.md` を作成（Obsidian↔AI間の連携用）

### 4. GitHubへのデプロイ準備
- **Git/GitHub CLI**: wingetでインストール完了
- **リポジトリ**: https://github.com/13koyoocol/emo-sns
- **初回コミット**: 全ファイルをpush済み

---

## ✅ 2026年2月10日の作業

### 5. Vercel本番デプロイ
- 🌐 **本番URL**: https://emo-sns.vercel.app
- **デプロイ方法**: Vercel CLI (`npx vercel --prod`)
- **自動デプロイ**: `git push origin master` で自動反映
- **Vercelアカウント**: GitHubアカウント（13koyoocol）で連携済み

### 6. 投稿エラーの修正（Vercel対応）
- **問題**: Vercel上で投稿すると「投稿に失敗しました: Failed to create post」エラー
- **原因**: Vercelのサーバーレス環境はファイルシステムが読み取り専用。`fs.writeFile()` で `data/posts.json` に書き込めなかった
- **対応**:
  - `src/lib/data.ts` — `fs`モジュールによるファイル読み書きを**インメモリストレージ**に置き換え
  - `src/app/api/reports/route.ts` — 同様にインメモリ化
- **注意**: コールドスタート時にデータはリセットされる。本格運用にはDB移行が必要

### 7. ドキュメント更新
- `shared_memo.md` — デプロイ完了ステータス更新、スマホ対応TODOを追加
- `えもSNS のロードマップ.md` — Phase 1のチェックリスト更新、スマホ対応を追加

---

## ✅ 2026年2月11日の作業

### 8. データベース移行（インメモリ → Supabase PostgreSQL）
- **Supabase**（無料PostgreSQLデータベース）に移行
- **変更ファイル**:
  - `src/lib/supabase.ts` — Supabaseクライアント初期化（新規作成）
  - `src/lib/data.ts` — インメモリ配列 → Supabaseクエリに全面書き換え
  - `src/app/api/reports/route.ts` — インメモリ → Supabase INSERT
  - `.env.local` — Supabase接続情報
- **DBテーブル**: `posts`, `comments`, `reports` の3テーブル作成
- **Vercel環境変数**: `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY` 設定済み
- **効果**: サーバー再起動してもデータが消えなくなった

### 9. スマホ対応（レスポンシブデザイン）
- **全コンポーネント**のCSSにモバイル用メディアクエリを実装
- **対応内容**:
  - `layout.tsx` — viewport設定の追加（iOS自動ズーム防止）
  - `globals.css` — モバイル用の基本スタイル、ボタンサイズ最適化
  - 各コンポーネント — 余白調整、配置変更（縦並びなど）
- **確認**: Vercelデプロイ済み（スマホ実機確認待ち）

### 10. OpenCode（AIコーディングツール）導入
- **インストール**:
  - `GoLang` (v1.26.0)
  - `OpenCode` (v0.0.55)
  - `ripgrep`, `fzf`
- **設定**: `.opencode.json` にGemini API連携を設定済み
- **起動スクリプト**: `opencode.bat` を作成（PATH問題回避用）
- **起動方法**: ターミナルで `.\opencode` を実行

### 11. ビジネスモデルのブラッシュアップ（Phase 2計画）
- **コンセプト再確認**: 「安心できる居場所」として、言葉による共有（コメント機能）は維持しつつ、AIで安全性を担保する方針で合意。
- **AIモデレーション戦略（Gentle Filter）**:
  - 単なる削除ではなく、「攻撃的な言葉を柔らかい表現に言い換える提案」を行うAIフィルターを実装予定。
  - **コスト計算**: 松プラン（GPT-4o等）は赤字になるため、**梅プラン（GPT-4o mini / Gemini Flash）** を採用。月額1ユーザー数10円程度に抑える。
  - **ロードマップ更新**: Phase 2 に「AIモデレーション導入（コスト重視）」を追加済み。

---

## ✅ 2026年2月13日の作業

### 12. Gemini思考モードで壁打ち（自分語り＆ビジネス分析）
- **内容**: 開発者の原体験（アルバイト先での孤独感・心の凍結）をGeminiに共有し、分析してもらった
- **得られたインサイト**:
  - **ミッション**: 「感情を静かに解凍し、明日への深呼吸を提供する」
  - **差別化**: 拡散ではなく「共鳴」、フロー型ではなく「ストック型（メンタルログ）」
  - **新機能**: AIメンター（肯定メッセージ）、お守り機能（パーソナルギャラリー）
  - **新マネタイズ**: サポータープラン（有料サブスク）、B2Bデータマーケティング
  - **収益目標**: 月10万円（低稼働自動運営）

### 13. ドキュメント全面更新
- `えもSNS ビジネスモデル.md` — ミッション/原体験/差別化/マネタイズを全面リライト
- `えもSNS のロードマップ.md` — Phase 2にAIメンター・お守り追加、Phase 3にサポータープラン追加、Phase 4（B2B）新設
- `shared_memo.md` — Gemini壁打ちインサイトを追記

### 14. GA4（Google Analytics 4）導入
- **実装**:
  - `@next/third-parties` パッケージ導入
  - `layout.tsx` に `GoogleAnalytics` コンポーネント追加
  - Vercel環境変数 `NEXT_PUBLIC_GA_ID` 設定済み
- **現状**: コードは反映済みだが、リアルタイムレポートでデータ受信が確認できていない
- **次のタスク**: GA4のデータ計測が正常に行われるよう調査・修正する

---

## 📁 重要ファイル一覧

| ファイル | 説明 |
|----------|------|
| `src/app/page.tsx` | メインページ、コメントエラー処理 |
| `src/lib/data.ts` | データ管理（インメモリストレージ） |
| `src/components/CommentSection.tsx` | コメント表示・ブロック機能 |
| `src/lib/blockList.ts` | ブロックリスト管理 |
| `src/lib/supabase.ts` | Supabaseクライアント初期化 |
| `src/app/api/comments/route.ts` | コメントAPI（NGワードフィルター） |
| `src/app/api/reports/route.ts` | 報告API（インメモリストレージ） |
| `opencode.bat` | OpenCode起動用スクリプト |
| `shared_memo.md` | AI連携用メモ |
| `えもSNS のロードマップ.md` | 開発ロードマップ |

---

## 🚀 今後の予定

### 優先（Phase 1 残り）
- [x] 📱 {{スマホ対応（レスポンシブデザイン）}} ← **実装完了（2026/2/11）**
- [x] データベース移行 → **Supabase PostgreSQL に移行完了（2026/2/11）**
- [x] 基本的なSEO設定

### 優先（Phase 1 残り / 修正）
- [ ] 🐛 **GA4のデータ計測がされない問題を修正** ← 次のタスク
- [ ] ユーザー認証（匿名 + 任意アカウント）

- [ ] AIモデレーション導入（Gentle Filter / Gemini API）
- [ ] AIメンター（感情ログ分析 → 肯定メッセージ）
- [ ] お守り機能（パーソナル・ギャラリー）
- [ ] ネイティブ広告導入（Google AdSense）
- [ ] 分析ツール導入（GA4）

### Phase 3: 収益化 & アプリ検討
- [ ] サポータープラン（有料サブスク）導入
- [ ] React Native / Flutter でアプリ開発
- [ ] プッシュ通知
- [ ] SNS連携シェア機能

### Phase 4: スケール
- [ ] B2Bデータマーケティング
- [ ] コミュニティ機能

---

## 🔑 アカウント情報

| サービス | ユーザー名 / 情報 |
|----------|------------|
| GitHub | 13koyoocol |
| Vercel | （GitHubアカウントで連携） |
| Supabase | （GitHubアカウントで連携） |
| Supabase DB パスワード | 13koyo0526H |

---

## 💡 備考

- GitHubのUIは日本語対応なし（英語のみ）
- Vercel無料プランで個人開発は問題なし
- `git push origin master` するだけで自動デプロイされる
- ~~現在のデータ保存はインメモリ~~ → **Supabase PostgreSQL に移行済み（データ永続化OK）**
